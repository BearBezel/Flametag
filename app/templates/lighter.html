{% extends "base.html" %}
{% block content %}

<div class="page">

  <div class="page-header">
    <div class="badge">Lighter ID: <span class="code">{{ lighter.token }}</span></div>

    <h1 class="page-title" style="margin-top:14px;">
      {% if lighter.is_claimed() %}
        This lighter is tagged
      {% else %}
        Untagged lighter
      {% endif %}
    </h1>

    <p class="page-subtitle">
      Scans: {{ lighter.scan_count }}
      {% if lighter.found_at %}
        â€¢ Marked found
      {% endif %}
    </p>
  </div>

  {% if lighter.is_claimed() %}

    <!-- Public message -->
    <div class="panel">
      <div class="section-title">Public message</div>
      <p style="margin:0; font-size:18px; line-height:1.5; color:rgba(255,255,255,0.92);">
        {{ lighter.public_message }}
      </p>
    </div>

    <div class="row">

      <!-- Unlock -->
      <div class="panel">
        <div class="section-title">Unlock private message</div>
        <form method="post" action="{{ url_for('main.unlock_private', token=lighter.token) }}" class="stack">
          <div>
            <label>PIN</label>
            <input name="pin" placeholder="Enter PIN" />
          </div>

          <div class="btn-row">
            <button class="btn primary" type="submit">Unlock</button>
            <a class="btn secondary" href="{{ url_for('main.home') }}" style="text-align:center; line-height: 44px; text-decoration:none;">Home</a>
          </div>

          <div class="small-note">
            Only the ownerâ€™s PIN can unlock the private message.
          </div>
        </form>
      </div>

      <!-- Owner edit -->
      <div class="panel">
        <div class="section-title">Owner edit</div>
        <form method="post" action="{{ url_for('main.edit_lighter', token=lighter.token) }}" class="stack">
          <div>
            <label>Owner PIN</label>
            <input name="pin" placeholder="Owner PIN" />
          </div>

          <div>
            <label>Public message</label>
            <textarea name="public_message" placeholder="e.g., Please return â€” thank you ðŸ™"></textarea>
          </div>

          <div>
            <label>Private message</label>
            <textarea name="private_message" placeholder="e.g., Return to Samuel â€” DM @____"></textarea>
          </div>

          <button class="btn primary" type="submit">Update</button>

          <div class="small-note">
            Tip: keep the public message short. Put contact details in the private message.
          </div>
        </form>
      </div>

    </div>

    <!-- Found note -->
    <div class="panel">
      <div class="section-title">Found this lighter?</div>

      {% if lighter.found_at and lighter.found_note %}
        <div class="small-note" style="margin-bottom:12px;">
          A note was already left for the owner.
        </div>
        <div style="padding:14px 16px; border-radius:16px; border:1px solid rgba(255,255,255,0.12); background: rgba(0,0,0,0.18);">
          <div class="small-note" style="margin:0 0 6px;">Note</div>
          <div style="color: rgba(255,255,255,0.92); white-space: pre-wrap;">{{ lighter.found_note }}</div>
        </div>
      {% endif %}

      <form method="post" action="{{ url_for('main.found_lighter', token=lighter.token) }}" class="stack" style="margin-top:14px;">
        <div>
          <label>Your note</label>
          <textarea name="found_note" placeholder="e.g., Found at Shoreditch station. Text me on 07â€¦" required></textarea>
        </div>

        <button class="btn secondary" type="submit">Send note</button>

        <div class="small-note">
          This doesnâ€™t unlock anything â€” it only saves a message for the owner to see.
        </div>
      </form>
    </div>

  {% else %}

    <!-- Claim -->
    <div class="panel">
      <div class="section-title">Tag this lighter</div>
      <p class="page-subtitle" style="margin-top:0;">
        Set a public message and a private message. The private message is locked with your PIN.
      </p>

      <form method="post" action="{{ url_for('main.claim_lighter', token=lighter.token) }}" class="stack">
        <div>
          <label>Public message</label>
          <textarea name="public_message" placeholder="e.g., This lighter is owned â€” please return ðŸ™"></textarea>
        </div>

        <div>
          <label>Private message</label>
          <textarea name="private_message" placeholder="e.g., Return to Samuel â€” DM @____"></textarea>
        </div>

        <div>
          <label>Create a PIN (min 4)</label>
          <input name="pin" placeholder="Create a PIN" />
        </div>

        <button class="btn primary" type="submit">Tag it</button>
      </form>
    </div>

  {% endif %}

</div>

{% endblock %}
